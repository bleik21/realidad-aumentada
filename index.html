<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>GeoGebra AR con HTML</title>
    <!-- Librerías para AR (AR.js y A-Frame) -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <!-- API de GeoGebra -->
    <script src="https://www.geogebra.org/apps/deployggb.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        #ggb-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        #ar-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; }
    </style>
</head>
<body>
    <!-- Contenedor para GeoGebra (oculto inicialmente) -->
    <div id="ggb-container"></div>
    
    <!-- Escena AR.js -->
    <div id="ar-container">
        <a-scene embedded arjs="detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
            <!-- Marcador "Hiro" (https://jeromeetienne.github.io/AR.js/data/images/HIRO.jpg) -->
            <a-marker preset="hiro" id="hiro-marker">
                <!-- Gráfico 3D de la ecuación (se actualiza desde GeoGebra) -->
                <a-entity id="equation-3d" position="0 0 0" scale="0.5 0.5 0.5">
                    <a-text id="equation-text" value="Ecuación" color="blue" align="center"></a-text>
                </a-entity>
            </a-marker>
            <a-entity camera></a-entity>
        </a-scene>
    </div>

    <script>
        // 1. Inicializar GeoGebra
        var ggbApp = new GGBApplet({
            "appName": "graphing",
            "width": 0,    // Oculto inicialmente
            "height": 0,
            "showToolBar": false,
            "showAlgebraInput": false
        }, "ggb-container");
        ggbApp.inject();

        // 2. Cuando se detecte el marcador AR, graficar la ecuación en GeoGebra y mostrarla en 3D
        document.querySelector("#hiro-marker").addEventListener("markerFound", () => {
            const equation = "x^2";  // Ecuación por defecto (puedes cambiarla dinámicamente)
            
            // Graficar en GeoGebra
            ggbApp.evalCommand(`f(x) = ${equation}`);
            
            // Mostrar en AR
            document.querySelector("#equation-text").setAttribute("value", `f(x) = ${equation}`);
            
            console.log("Ecuación mostrada en AR:", equation);
        });

        // 3. Opcional: Ocultar AR si no hay marcador
        document.querySelector("#hiro-marker").addEventListener("markerLost", () => {
            console.log("Marcador perdido");
        });
    </script>
</body>
</html>